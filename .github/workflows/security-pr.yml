name: Security Gate

# TRIGGER: Runs on Pull Requests (unlike the Daily Patrol)
on:
  pull_request:
    paths:
      - '**/Cargo.lock'
      - '**/package-lock.json'

jobs:
  security-scan: # <--- This is the ID that will appear in Branch Protection
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. Check Rust Logic
      - name: Install cargo-audit
        run: cargo install cargo-audit
      
      - name: Audit Rust Crates
        run: cargo audit
        working-directory: ./backend

      # 2. Check Extension Logic
      - name: Audit NPM Packages
        run: npm audit --audit-level=high
        working-directory: ./extension
